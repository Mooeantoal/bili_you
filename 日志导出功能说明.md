# BiliYou 调试日志导出功能使用说明

## 功能概述

为 BiliYou 应用的调试工具增加了日志导出到手机存储的功能，支持将错误日志保存为文件或快速分享。

## 主要特性

### 1. 权限管理
- 自动检测并请求存储权限
- 支持 Android 13+ 的新权限模型
- 兼容旧版本 Android 系统
- 权限被拒绝时提供详细说明和解决方案

### 2. 导出方式

#### 完整导出到存储
- 将日志保存为 JSON 格式文件
- 保存位置：`/storage/emulated/0/Download/BiliYou_Debug_Logs_[时间戳].json`
- 包含完整的错误详情和应用信息
- 支持文件分享功能

#### 快速分享
- 生成文本格式的简化日志
- 通过系统分享功能发送
- 适合即时分享和问题反馈

### 3. 日志格式

#### JSON 格式（完整导出）
```json
{
  "app_name": "BiliYou",
  "export_time": "2025-09-12T11:09:08.000Z",
  "total_logs": 2,
  "app_version": "1.1.5+15",
  "platform": "android",
  "logs": [
    {
      "timestamp": "2025-09-12T11:08:30.000Z",
      "type": "BVID_CONVERSION_ERROR",
      "message": "BVID转换失败",
      "details": {
        "input_bvid": "BV16hHDZSEzt",
        "algorithm": "official_bilibili_algorithm",
        "error_type": "ArgumentError"
      }
    }
  ]
}
```

#### 文本格式（快速分享）
```
=== BiliYou 调试日志 ===
导出时间: 2025-09-12 11:09:08
总计错误: 2 条
应用版本: 1.1.5+15

--- 错误 1 ---
时间: 2025-09-12 11:08:30
类型: BVID_CONVERSION_ERROR
消息: BVID转换失败
详情:
  input_bvid: BV16hHDZSEzt
  algorithm: official_bilibili_algorithm
```

## 使用方法

### 1. 访问调试工具
1. 在视频页面遇到评论加载问题时，点击"调试诊断"
2. 或通过设置中的调试选项进入

### 2. 生成日志
1. 在调试页面输入问题视频的 BVID
2. 点击"开始调试"执行检测
3. 系统会自动记录遇到的错误

### 3. 导出日志

#### 方法一：保存到手机存储
1. 点击"导出日志"按钮
2. 选择"保存到手机存储"
3. 首次使用时会申请存储权限
4. 确认权限后文件将保存到 Downloads 文件夹
5. 可选择分享已保存的文件

#### 方法二：快速分享
1. 点击"导出日志"按钮
2. 选择"快速分享"
3. 选择分享到的应用（如微信、QQ、邮件等）

### 4. 测试功能
- 点击"测试日志"按钮可以生成示例错误日志
- 用于测试导出功能是否正常工作

## 技术实现

### 依赖组件
- `permission_handler`: 权限管理
- `path_provider`: 获取存储路径
- `share_plus`: 文件分享功能

### 权限配置
已在 `AndroidManifest.xml` 中添加必要权限：
- `WRITE_EXTERNAL_STORAGE`
- `READ_EXTERNAL_STORAGE`
- `READ_MEDIA_*` (Android 13+)
- `MANAGE_EXTERNAL_STORAGE` (可选)

### 主要文件
- `lib/common/utils/log_export_util.dart`: 日志导出核心逻辑
- `lib/pages/debug/native_reply_debug_page.dart`: 调试页面UI
- `lib/common/utils/debug_utils.dart`: 调试工具入口

## 注意事项

1. **权限要求**: 首次使用需要授予存储权限
2. **存储空间**: 确保设备有足够存储空间
3. **文件位置**: 导出的文件保存在 Downloads 文件夹中
4. **隐私保护**: 日志仅包含技术调试信息，不含用户隐私数据
5. **兼容性**: 支持 Android 6.0+ 系统

## 故障排除

### 权限被拒绝
- 手动进入系统设置 → 应用管理 → BiliYou → 权限管理
- 开启"存储"权限

### 保存失败
- 检查存储空间是否充足
- 确认 Downloads 文件夹是否可访问
- 重启应用后重试

### 分享功能异常
- 确保设备安装有支持文件分享的应用
- 检查网络连接（某些分享需要网络）

## 更新记录

- v1.1.5+15: 新增日志导出功能
- 支持完整 JSON 格式和简化文本格式导出
- 自动权限管理和错误处理
- 集成到现有调试工具中