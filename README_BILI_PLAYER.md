# B站播放器测试页面说明

## 功能介绍

本项目在测试页面中集成了B站官方播放器，通过WebView嵌入的方式实现。用户可以直接在应用中播放B站视频，无需跳转到浏览器或其他应用。

本实现采用了改进代码0.2版本的方案，使用响应式设计，可以更好地适配不同屏幕尺寸。

## 实现原理

1. 使用WebView组件嵌入B站官方播放器
2. 通过B站提供的iframe播放器URL加载视频
3. 采用改进代码0.2版本的响应式容器设计
4. 支持自定义视频ID、CID等参数
5. 提供播放控制选项（自动播放、弹幕开关、静音等）
6. 支持切换播放器样式（移动端/PC端）
7. 支持查看视频评论功能
8. 支持查看视频详细信息功能
9. **整合播放器、视频详细信息和评论到统一界面**

## 改进代码0.2版本方案说明

改进代码0.2版本使用了响应式设计，通过以下方式实现：

```
<div style="position: relative; padding: 30% 45%;">
<iframe style="position: absolute; width: 100%; height: 100%; left: 0; top: 0;" src="//player.bilibili.com/player.html?aid=928861104&bvid=BV1uT4y1P7CX&cid=287639008&page=1" frameborder="no" scrolling="no"></iframe>
</div>
```

在Flutter中，我们通过LayoutBuilder和Container来实现类似的响应式效果，确保播放器在不同设备上都能正确显示。

## 播放器样式切换功能

根据参考文章中的说明，B站提供了两种播放器：
1. **移动端播放器**：URL为 `https://www.bilibili.com/blackboard/html5mobileplayer.html`，界面更清爽
2. **PC端播放器**：URL为 `https://player.bilibili.com/player.html`，功能更丰富但可能较臃肿

本实现支持在两种播放器样式之间切换：
- 在基础版和测试版中，点击 AppBar 左上角的图标（💻/📱）进行切换
- 在高级版中，可以在设置对话框中选择使用PC端播放器

## 视频评论查看功能

根据 [UAPI提供的API](https://uapis.cn/docs/api-reference/get-social-bilibili-replies)，我们实现了查看视频评论的功能：

### API接口说明
- **接口地址**：`https://uapis.cn/api/v1/social/bilibili/replies`
- **请求方法**：GET
- **必需参数**：
  - `oid`：目标评论区的ID（对于视频，这通常就是它的 aid）
- **可选参数**：
  - `sort`：排序方式（0=按时间，1=按点赞，2=按回复）
  - `ps`：每页获取的评论数量（1-20，默认20）
  - `pn`：要获取的页码（从1开始，默认1）

### 功能特点
1. 支持分页加载评论
2. 支持多种排序方式
3. 显示热门评论和普通评论
4. 显示评论的点赞数和回复数
5. 显示用户头像和评论时间

## 视频详细信息查看功能

根据 [UAPI提供的API](https://uapis.cn/docs/api-reference/get-social-bilibili-videoinfo)，我们实现了查看视频详细信息的功能：

### API接口说明
- **接口地址**：`https://uapis.cn/api/v1/social/bilibili/videoinfo`
- **请求方法**：GET
- **必需参数**：
  - `aid`：视频的AV号（纯数字格式）
  - `bvid`：视频的BV号（例如 BV117411r7R1）
  - aid和bvid任选其一即可

### 功能特点
1. 显示视频标题、封面、时长等基本信息
2. 显示播放量、弹幕数、评论数等统计数据
3. 显示UP主信息（头像、昵称、UID）
4. 显示视频描述和分P列表
5. 支持原创/转载标识

## 整合界面功能

参考普通播放界面布局，我们将播放器、视频详细信息和评论功能整合到一个统一的界面中：

### 界面布局
1. **顶部播放器区域**：嵌入B站官方播放器
2. **Tab导航栏**：包含简介、评论、更多三个Tab
3. **Tab内容区域**：
   - 简介Tab：显示视频详细信息
   - 评论Tab：显示视频评论
   - 更多Tab：显示视频参数和操作说明

### 交互特点
1. 通过Tab导航切换不同内容模块
2. 支持播放器样式切换（移动端/PC端）
3. 支持刷新播放器和页面内容
4. 响应式设计适配不同屏幕尺寸

## 使用方法

### 主页面导航栏入口

现在在主页面的导航栏中已经添加了播放器的入口：
1. 在桌面端：导航栏中会显示"测试"选项
2. 在移动端：底部导航栏中会显示"测试"选项
3. 点击该选项可以直接进入播放器页面

### 导航测试页面入口

1. 在应用底部导航栏点击"测试"选项卡
2. 进入整合的B站播放器测试页面
3. 页面会自动加载默认视频
4. 通过顶部的Tab导航切换简介、评论和更多内容
5. 点击左上角图标（💻/📱）可在PC端和移动端播放器样式间切换
6. 点击右上角刷新按钮可重新加载播放器

### 专门的测试入口

为了方便测试播放器，我们还提供了一个专门的测试入口文件：
- `lib/main_test.dart`: 播放器测试入口文件

可以通过以下命令运行：
```
flutter run -t lib/main_test.dart
```

