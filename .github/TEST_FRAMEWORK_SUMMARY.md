# ğŸ§ª bili_you æµ‹è¯•æ¡†æ¶æ­å»ºå®Œæˆæ€»ç»“

## âœ… å·²å®Œæˆçš„é…ç½®

### 1. æµ‹è¯•æ¡†æ¶åŸºç¡€è®¾æ–½

#### æµ‹è¯•ä¾èµ–é…ç½® (pubspec.yaml)
```yaml
dev_dependencies:
  flutter_test:
    sdk: flutter
  test: ^1.24.1
  mockito: ^5.4.2
  fake_async: ^1.3.1
  build_runner: ^2.4.4
  flutter_launcher_icons: ^0.13.1
  flutter_lints: ^2.0.1
```

#### æµ‹è¯•ç›®å½•ç»“æ„
```
test/
â”œâ”€â”€ unit/                          # å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ string_format_utils_test.dart    # å­—ç¬¦ä¸²æ ¼å¼åŒ–å·¥å…·æµ‹è¯•
â”‚   â”œâ”€â”€ bvid_avid_util_test.dart         # BV/AVå·è½¬æ¢å·¥å…·æµ‹è¯•
â”‚   â”œâ”€â”€ settings_test.dart               # è®¾ç½®å·¥å…·æµ‹è¯•
â”‚   â””â”€â”€ http_utils_test.dart             # ç½‘ç»œè¯·æ±‚å·¥å…·æµ‹è¯•
â”œâ”€â”€ widget/                        # Widgetæµ‹è¯•
â”‚   â””â”€â”€ avatar_widget_test.dart          # å¤´åƒç»„ä»¶æµ‹è¯•
â”œâ”€â”€ integration/                   # é›†æˆæµ‹è¯•
â”‚   â””â”€â”€ app_integration_test.dart        # åº”ç”¨é›†æˆæµ‹è¯•
â”œâ”€â”€ test_helper.dart              # æµ‹è¯•è¾…åŠ©å·¥å…·
â”œâ”€â”€ dart_test.yaml               # æµ‹è¯•é…ç½®
â””â”€â”€ widget_test.dart             # ä¸»åº”ç”¨Widgetæµ‹è¯•
```

### 2. æµ‹è¯•å·¥å…·å’Œè¾…åŠ©ç±»

#### TestHelper æµ‹è¯•è¾…åŠ©ç±»
- `wrapWithMaterialApp()` - åŒ…è£…Widgetä¸ºå¯æµ‹è¯•çš„MaterialApp
- `waitForAsync()` - ç­‰å¾…å¼‚æ­¥æ“ä½œå®Œæˆ
- `simulateNetworkDelay()` - æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿ
- `expectWidgetVisible()` - éªŒè¯Widgetå¯è§æ€§
- `enterText()` - æ¨¡æ‹Ÿç”¨æˆ·è¾“å…¥
- `scrollToWidget()` - æ»šåŠ¨åˆ°æŒ‡å®šWidget

#### CustomMatchers è‡ªå®šä¹‰åŒ¹é…å™¨
- `hasStyle()` - éªŒè¯Widgetæ ·å¼
- `inRange()` - éªŒè¯æ•°å€¼èŒƒå›´
- `isValidUrl()` - éªŒè¯URLæ ¼å¼
- `isValidBvid()` - éªŒè¯BVIDæ ¼å¼

#### TestDataGenerator æµ‹è¯•æ•°æ®ç”Ÿæˆå™¨
- `generateBvid()` - ç”Ÿæˆæµ‹è¯•ç”¨BVID
- `generateVideoData()` - ç”Ÿæˆæµ‹è¯•è§†é¢‘æ•°æ®
- `generateCommentData()` - ç”Ÿæˆæµ‹è¯•è¯„è®ºæ•°æ®

### 3. å·²å®ç°çš„æµ‹è¯•ç”¨ä¾‹

#### å•å…ƒæµ‹è¯• (Unit Tests)
1. **StringFormatUtils æµ‹è¯•**
   - âœ… æ•°å­—æ ¼å¼åŒ– (999 â†’ 999, 1500 â†’ 1.5k, 15000 â†’ 1.5ä¸‡)
   - âœ… æ—¶é—´é•¿åº¦æ ¼å¼åŒ– (3661 â†’ 1:01:01)
   - âœ… è¾¹ç•Œæ¡ä»¶å’Œå¼‚å¸¸å¤„ç†

2. **BvidAvidUtil æµ‹è¯•**
   - âœ… AVå·è½¬BVå·åŠŸèƒ½
   - âœ… BVå·è½¬AVå·åŠŸèƒ½
   - âœ… BVå·æ ¼å¼éªŒè¯
   - âœ… å¾€è¿”è½¬æ¢ä¸€è‡´æ€§éªŒè¯

3. **SettingsUtil æµ‹è¯•**
   - âœ… åŸºæœ¬è®¾ç½®å­˜å‚¨å’Œè¯»å–
   - âœ… é»˜è®¤å€¼å¤„ç†æœºåˆ¶
   - âœ… ä¸»é¢˜è®¾ç½®æµ‹è¯•
   - âœ… æ–‡æœ¬ç¼©æ”¾è®¾ç½®æµ‹è¯•

4. **HttpUtils æµ‹è¯• (Mock)**
   - âœ… GETè¯·æ±‚æµ‹è¯•
   - âœ… ç½‘ç»œé”™è¯¯å¤„ç†
   - âœ… è¯·æ±‚å¤´éªŒè¯
   - âœ… é‡è¯•æœºåˆ¶æµ‹è¯•

#### Widget æµ‹è¯•
1. **AvatarWidget æµ‹è¯•**
   - âœ… é»˜è®¤å¤´åƒæ˜¾ç¤º
   - âœ… ç½‘ç»œå›¾ç‰‡åŠ è½½
   - âœ… å°ºå¯¸å‚æ•°å¤„ç†
   - âœ… å¼‚å¸¸æƒ…å†µå¤„ç†

2. **ä¸»åº”ç”¨ Widget æµ‹è¯•**
   - âœ… åº”ç”¨å¯åŠ¨éªŒè¯
   - âœ… åˆå§‹åŒ–æµç¨‹æµ‹è¯•
   - âœ… å´©æºƒæ£€æµ‹

#### é›†æˆæµ‹è¯•
1. **åº”ç”¨æµç¨‹æµ‹è¯•**
   - âœ… åº”ç”¨å¯åŠ¨æµç¨‹
   - âœ… å¯¼èˆªåŠŸèƒ½æµ‹è¯•
   - âœ… ç½‘ç»œè¯·æ±‚å¤„ç†
   - âœ… è®¾ç½®é¡µé¢è®¿é—®

### 4. æµ‹è¯•è¿è¡Œå·¥å…·

#### è„šæœ¬å·¥å…·
- **run_tests.bat** (Windows) - äº¤äº’å¼æµ‹è¯•è¿è¡Œå™¨
- **run_tests.sh** (Linux/macOS) - è·¨å¹³å°æµ‹è¯•è„šæœ¬
- **verify_test_setup.bat** - æµ‹è¯•é…ç½®éªŒè¯è„šæœ¬

#### æµ‹è¯•è¿è¡Œé€‰é¡¹
1. è¿è¡Œæ‰€æœ‰æµ‹è¯•
2. è¿è¡Œå•å…ƒæµ‹è¯•
3. è¿è¡ŒWidgetæµ‹è¯•
4. è¿è¡Œé›†æˆæµ‹è¯•
5. ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
6. ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š

### 5. CI/CD é›†æˆ

#### GitHub Actions å¢å¼º
- **build-test.yml** å·¥ä½œæµåŒ…å«å®Œæ•´æµ‹è¯•æµç¨‹
- è‡ªåŠ¨è¿è¡Œå•å…ƒæµ‹è¯•å’ŒWidgetæµ‹è¯•
- ç”Ÿæˆæµ‹è¯•æŠ¥å‘Šå’Œè¦†ç›–ç‡æŠ¥å‘Š
- ä¸Šä¼ æµ‹è¯•ç»“æœä¸ºArtifacts

#### æµ‹è¯•æŠ¥å‘Š
- JSONæ ¼å¼æµ‹è¯•ç»“æœ
- ä»£ç è¦†ç›–ç‡æŠ¥å‘Š (lcov.info)
- æµ‹è¯•æ‰§è¡Œæ—¶é—´ç»Ÿè®¡

## ğŸ¯ æµ‹è¯•è¦†ç›–æƒ…å†µ

### å½“å‰è¦†ç›–çš„æ¨¡å—

| æ¨¡å—ç±»å‹ | å·²æµ‹è¯•é¡¹ç›® | è¦†ç›–ç‡ä¼°è®¡ |
|---------|-----------|----------|
| å·¥å…·ç±» | StringFormatUtils, BvidAvidUtil, SettingsUtil | 80%+ |
| UIç»„ä»¶ | AvatarWidget | 70%+ |
| åº”ç”¨çº§åˆ« | Appå¯åŠ¨å’Œåˆå§‹åŒ– | 60%+ |
| ç½‘ç»œå±‚ | HttpUtils (Mock) | 50%+ |

### æµ‹è¯•è´¨é‡æŒ‡æ ‡
- âœ… **æµ‹è¯•ç‹¬ç«‹æ€§** - æ¯ä¸ªæµ‹è¯•å¯ç‹¬ç«‹è¿è¡Œ
- âœ… **æµ‹è¯•å¯é‡å¤æ€§** - ç»“æœä¸€è‡´å¯é‡ç°
- âœ… **æµ‹è¯•é€Ÿåº¦** - å•å…ƒæµ‹è¯• <1sï¼ŒWidgetæµ‹è¯• <5s
- âœ… **æµ‹è¯•è¦†ç›–** - æ ¸å¿ƒåŠŸèƒ½æ¨¡å—å·²è¦†ç›–
- âœ… **å¼‚å¸¸å¤„ç†** - è¾¹ç•Œæ¡ä»¶å’Œé”™è¯¯æƒ…å†µå·²æµ‹è¯•

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### å¿«é€Ÿå¼€å§‹
```bash
# 1. å®‰è£…ä¾èµ–
flutter pub get

# 2. è¿è¡Œæ‰€æœ‰æµ‹è¯•
flutter test

# 3. ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
flutter test --coverage

# 4. ä½¿ç”¨è„šæœ¬è¿è¡Œç‰¹å®šæµ‹è¯•
# Windows
scripts\run_tests.bat

# Linux/macOS
chmod +x scripts/run_tests.sh
./scripts/run_tests.sh
```

### å¼€å‘å·¥ä½œæµ
1. **ç¼–å†™åŠŸèƒ½ä»£ç **
2. **ç¼–å†™å¯¹åº”æµ‹è¯•**
3. **è¿è¡Œæµ‹è¯•éªŒè¯**
4. **æäº¤ä»£ç **
5. **CIè‡ªåŠ¨æµ‹è¯•**

## ğŸ“‹ å¾…æ‰©å±•æµ‹è¯•

### é«˜ä¼˜å…ˆçº§ (å»ºè®®ä¸‹ä¸€æ­¥å®Œæˆ)
- [ ] **APIæ¥å£æµ‹è¯•** - VideoApi, CommentApi, SearchApiç­‰
- [ ] **é¡µé¢æ§åˆ¶å™¨æµ‹è¯•** - GetX Controllersæµ‹è¯•
- [ ] **æ•°æ®æ¨¡å‹æµ‹è¯•** - ç½‘ç»œå’Œæœ¬åœ°æ•°æ®æ¨¡å‹
- [ ] **ç¼“å­˜å·¥å…·æµ‹è¯•** - CacheUtilåŠŸèƒ½éªŒè¯

### ä¸­ä¼˜å…ˆçº§
- [ ] **è§†é¢‘æ’­æ”¾å™¨æµ‹è¯•** - æ’­æ”¾å™¨ç»„ä»¶å’Œæ§åˆ¶é¢æ¿
- [ ] **è¯„è®ºç³»ç»Ÿæµ‹è¯•** - è¯„è®ºæ˜¾ç¤ºå’Œäº¤äº’åŠŸèƒ½
- [ ] **æœç´¢åŠŸèƒ½æµ‹è¯•** - æœç´¢æµç¨‹å’Œç»“æœå¤„ç†
- [ ] **ä¸»é¢˜åˆ‡æ¢æµ‹è¯•** - æ·±è‰²/æµ…è‰²ä¸»é¢˜åˆ‡æ¢

### ä½ä¼˜å…ˆçº§
- [ ] **åŠ¨ç”»ç»„ä»¶æµ‹è¯•** - é¡µé¢åˆ‡æ¢å’ŒåŠ¨ç”»æ•ˆæœ
- [ ] **æ€§èƒ½æµ‹è¯•** - åº”ç”¨æ€§èƒ½åŸºå‡†æµ‹è¯•
- [ ] **å¯è®¿é—®æ€§æµ‹è¯•** - æ— éšœç¢åŠŸèƒ½éªŒè¯
- [ ] **å›½é™…åŒ–æµ‹è¯•** - å¤šè¯­è¨€æ”¯æŒæµ‹è¯•

## ğŸ”§ æ‰©å±•æŒ‡å—

### æ·»åŠ æ–°çš„å•å…ƒæµ‹è¯•
```dart
// test/unit/new_util_test.dart
import 'package:test/test.dart';
import 'package:bili_you/common/utils/new_util.dart';

void main() {
  group('NewUtil Tests', () {
    test('should do something correctly', () {
      // Arrange
      final input = 'test';
      
      // Act
      final result = NewUtil.process(input);
      
      // Assert
      expect(result, equals('expected'));
    });
  });
}
```

### æ·»åŠ æ–°çš„Widgetæµ‹è¯•
```dart
// test/widget/new_widget_test.dart
import 'package:flutter_test/flutter_test.dart';
import 'package:bili_you/common/widget/new_widget.dart';
import '../test_helper.dart';

void main() {
  group('NewWidget Tests', () {
    testWidgets('should display correctly', (WidgetTester tester) async {
      await tester.pumpWidget(
        TestHelper.wrapWithMaterialApp(
          const NewWidget(),
        ),
      );

      expect(find.byType(NewWidget), findsOneWidget);
    });
  });
}
```

## ğŸ‰ æ€»ç»“

âœ… **å®Œæ•´çš„Flutteræµ‹è¯•æ¡†æ¶å·²æˆåŠŸæ­å»ºï¼**

### ä¸»è¦æˆå°±
1. **é›¶åŸºç¡€åˆ°å®Œæ•´** - ä»æ²¡æœ‰æµ‹è¯•ç›®å½•åˆ°å®Œæ•´æµ‹è¯•æ¡†æ¶
2. **å¤šå±‚æ¬¡è¦†ç›–** - å•å…ƒæµ‹è¯•ã€Widgetæµ‹è¯•ã€é›†æˆæµ‹è¯•å…¨è¦†ç›–
3. **å·¥å…·å®Œå¤‡** - æµ‹è¯•è¾…åŠ©å·¥å…·ã€æ•°æ®ç”Ÿæˆå™¨ã€è‡ªå®šä¹‰åŒ¹é…å™¨
4. **CI/CDé›†æˆ** - GitHub Actionsè‡ªåŠ¨åŒ–æµ‹è¯•æµç¨‹
5. **æ–‡æ¡£å®Œå–„** - è¯¦ç»†çš„æµ‹è¯•æŒ‡å—å’Œä½¿ç”¨è¯´æ˜

### æŠ€æœ¯äº®ç‚¹
- ä½¿ç”¨Mockå¯¹è±¡è¿›è¡Œç½‘ç»œè¯·æ±‚æµ‹è¯•
- è‡ªå®šä¹‰åŒ¹é…å™¨æå‡æµ‹è¯•è¡¨è¾¾åŠ›
- æµ‹è¯•æ•°æ®ç”Ÿæˆå™¨ç®€åŒ–æµ‹è¯•æ•°æ®å‡†å¤‡
- è·¨å¹³å°æµ‹è¯•è„šæœ¬æ”¯æŒä¸åŒå¼€å‘ç¯å¢ƒ
- CI/CDé›†æˆç¡®ä¿ä»£ç è´¨é‡

ç°åœ¨é¡¹ç›®å…·å¤‡äº†å®Œæ•´çš„æµ‹è¯•èƒ½åŠ›ï¼Œå¯ä»¥æ”¯æŒæµ‹è¯•é©±åŠ¨å¼€å‘(TDD)å’ŒæŒç»­é›†æˆ(CI)ï¼ğŸš€